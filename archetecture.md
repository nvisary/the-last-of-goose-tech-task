# Архитектура проекта "The Last of Guss"

Этот документ описывает архитектуру и структуру папок для бекенд и фронтенд частей проекта.

## 1. Backend

Бекенд будет построен на основе модульной архитектуры, где каждая бизнес-сущность (домен) вынесена в отдельный модуль. Это обеспечивает хорошую организацию кода, упрощает его поддержку и масштабирование.

### Структура папок

```
backend/
├── prisma/
│   ├── schema.prisma       # Схема данных для Prisma ORM
│   └── migrations/         # Автоматически генерируемые миграции
├── src/
│   ├── app.ts              # Инициализация Fastify, регистрация плагинов и роутов
│   ├── config/             # Конфигурация приложения (env переменные)
│   ├── lib/
│   │   └── prisma.ts         # Экземпляр PrismaClient для всего приложения
│   ├── plugins/
│   │   └── auth.ts           # Плагин Fastify для аутентификации (проверка JWT)
│   └── modules/
│       ├── users/
│       │   ├── user.model.ts     # Модель данных пользователя (типы)
│       │   └── user.service.ts   # Сервис для работы с пользователями (создание, поиск)
│       ├── auth/
│       │   ├── auth.routes.ts    # Роуты для аутентификации (/login)
│       │   ├── auth.controller.ts# Контроллер, обрабатывающий HTTP-запросы
│       │   └── auth.service.ts   # Бизнес-логика аутентификации
│       └── rounds/
│           ├── rounds.routes.ts    # Роуты для раундов (/rounds, /rounds/:id, /rounds/:id/tap)
│           ├── rounds.controller.ts# Контроллер для раундов
│           ├── rounds.service.ts   # Бизнес-логика раундов (создание, тап, смена статуса)
│           ├── rounds.model.ts     # Модели данных (типы) для раундов
│           └── rounds.background.ts# Логика для фонового обновления статусов раундов
├── .env                    # Файл с переменными окружения
├── package.json
└── tsconfig.json
```

### Поток данных

1.  **`app.ts`**: Точка входа. Создает экземпляр Fastify, загружает конфигурацию из `.env`.
2.  **Плагины (`plugins/`)**: Регистрируются плагины, например, для работы с cookie и наш кастомный плагин `auth.ts` для проверки JWT на защищенных роутах.
3.  **Роуты (`modules/*/routes.ts`)**: Регистрируются роуты для каждого модуля. Роут определяет URL, HTTP-метод и схему валидации.
4.  **Контроллер (`modules/*/controller.ts`)**: Вызывается роутом. Его задача — извлечь данные из запроса (тело, параметры, заголовки), вызвать соответствующий сервис и вернуть HTTP-ответ.
5.  **Сервис (`modules/*/service.ts`)**: Содержит основную бизнес-логику. Взаимодействует с базой данных через `PrismaClient` (из `lib/prisma.ts`), выполняет вычисления и возвращает результат контроллеру.
6.  **Модель (`modules/*/model.ts`)**: TypeScript-типы, описывающие структуры данных, используемые в модуле.

---

## 2. Frontend

Фронтенд будет построен с использованием методологии **Feature-Sliced Design (FSD)**. Это позволяет создавать масштабируемые и легко поддерживаемые приложения с четкими границами между модулями.

### Структура папок (FSD)

```
frontend/
├── public/
├── src/
│   ├── app/
│   │   ├── providers/        # Подключение всех провайдеров (роутер, стейт-менеджер)
│   │   ├── styles/           # Глобальные стили, темы
│   │   └── index.tsx         # Точка входа в приложение React
│   │
│   ├── pages/                # Страницы приложения, композиция виджетов и фич
│   │   ├── LoginPage/
│   │   ├── RoundsListPage/
│   │   └── RoundDetailsPage/
│   │
│   ├── widgets/              # Композиционный слой (например, "шапка", "карточка раунда")
│   │   ├── Header/
│   │   ├── RoundCard/
│   │   └── RoundStats/
│   │
│   ├── features/             # Бизнес-логика (например, "авторизация", "создание раунда")
│   │   ├── AuthByUsername/
│   │   ├── CreateRound/
│   │   └── TapGoose/
│   │
│   ├── entities/             # Бизнес-сущности (например, "пользователь", "раунд")
│   │   ├── User/
│   │   └── Round/
│   │
│   └── shared/               # Переиспользуемый код, не имеющий отношения к бизнес-логике
│       ├── api/              # Настройки и инстанс API-клиента (axios, fetch)
│       ├── config/           # Конфигурация приложения (роуты, переменные)
│       ├── lib/              # Вспомогательные функции, хуки (useCountdown)
│       └── ui/               # UI-kit (Button, Input, Spinner, Card)
│
├── index.html
├── package.json
└── tsconfig.json
```

### Описание слоев (FSD)

1.  **`app/`**: Инициализация приложения. Здесь подключаются глобальные стили, провайдеры для роутинга (`BrowserRouter`), стейт-менеджера (`Zustand`) и другие обертки.
2.  **`pages/`**: Слой страниц. Каждая папка — это отдельная страница приложения. Страницы собираются из виджетов и фич. Этот слой не должен содержать своей бизнес-логики.
3.  **`widgets/`**: Слой виджетов. Это крупные, самостоятельные блоки интерфейса, такие как `Header`, `Footer`, `Sidebar`. Виджеты собираются из фич и `shared/ui` компонентов. Например, `RoundCard` будет виджетом, который отображает информацию о раунде.
4.  **`features/`**: Слой фич. Реализует конкретные бизнес-сценарии. Например, `AuthByUsername` будет содержать форму логина, логику отправки запроса и обработку ответа. `TapGoose` будет содержать кнопку гуся и логику отправки тапа на сервер.
5.  **`entities/`**: Слой сущностей. Описывает бизнес-сущности, с которыми работает приложение. Например, `entities/User` будет содержать компонент для отображения аватара и имени пользователя, а также может хранить связанные с пользователем данные в стейт-менеджере. `entities/Round` будет содержать API-запросы для получения данных о раундах и хранилище (slice) для них в Zustand.
6.  **`shared/`**: Самый нижний слой. Содержит переиспользуемый код, который не зависит от бизнес-логики проекта.
    *   `ui/`: Набор "глупых" UI-компонентов (кнопки, инпуты, модальные окна).
    *   `api/`: Конфигурация клиента для отправки запросов на бекенд.
    *   `lib/`: Вспомогательные функции, хуки (`useDebounce`, `useForm`, etc.).
    *   `config/`: Глобальная конфигурация, константы, пути роутов.

Эта структура обеспечивает однонаправленный поток зависимостей (нижележащие слои не знают о вышележащих), что делает код предсказуемым и легко рефакторируемым.
